# ESP PWM Fan Control
This application reads the temperature from an 10 kOhm NTC (wired to 3.3V via 150 kOhm pull-up resistor) connected to A0 and enables you to automatically control three PWM channels separately. Of course, the resistances are configurable in the code.

Since the PWM frequency is limited on the ESP, the range of possible values has been reduced from 1024 to five states: 0, 25, 50, 75 and 100 %. This works well with our Arctic P12 PWM fans, even though we cannot measure the effective PWM frequency generated by the ESP8266 and it might be that the frequency still is too low (i.e. lower that 21 kHz). A greater range may be possible, too, but has not been tested yet. This may also depend on the fans used and their tolerance in regards of the PWM frequency which may be lower than the by specification required 21~28 kHz.  

Settings are stored in JSON format in SPIFFS.  

The web interface provides you full control over the fan settings and also an auto refresh function as well as raw JSON output for further use (and some other stuff).

The project is ready to display the fan levels, temperature and the auto fan control state on an 128x64px SSD1306 OLED connected via I2C.

Basic MQTT code is included, but commented out since not needed (until now).

**This project is in beta state.** Testing is still needed and proper functionality not yet ensured.

The uncompressed JavaScript code used in the web interface can be viewed [here](https://github.com/faeibson/ESPPWMFanControl/blob/master/assets/main.js). Same goes for the [CSS](https://github.com/faeibson/ESPPWMFanControl/blob/master/assets/main.css).

## How to install

Simply flash the project onto your ESP board through the Arduino IDE, or try out the [compiled binary](https://github.com/faeibson/ESPPWMFanControl/releases). You can flash it via [esptool](https://github.com/espressif/esptool) to your Wemos D1 mini, while NodeMCU and other similar boards with an ESP-12E or F (and maybe others) should work, too.

## Requirements

### Hardware
- An ESP8266
- NTC wired properly to V+, GND and A0 (schematic will be added soon)
- Fans connected to the desired I/O pins (and V+/GND, of course) - as of now, these are D7, D6 and D3
- (optional) An OLED connected to SDA/SCL (D2/D1)

### Software
- Arduino IDE (https://www.arduino.cc/en/Main/Software) (since 1.0-beta)
- Arduino IDE ESP8266 Libraries (https://github.com/esp8266/Arduino) (since 1.0-beta)
- ArduinoJson (https://github.com/bblanchon/ArduinoJson) (since 1.0-beta)
- Brzo I2C (https://github.com/pasko-zh/brzo_i2c) (since 1.0-beta)
- ESP8266 OLED driver for SSD1306 (https://github.com/ThingPulse/esp8266-oled-ssd1306) (since 1.0-beta)
- WiFiManager (https://github.com/tzapu/WiFiManager) (since 1.0-beta)
<!-- - ESP8266FS Plugin (https://github.com/esp8266/arduino-esp8266fs-plugin) (since 1.0-beta2)-->

<!-- ## Work in progress
- -->

## Possible future improvements / extensions

- Support multiple sensors.
- Support common digital temperature sensors. (DHT22, DS18B20, BME/BMP280)
- Support I2C in a general way.
- Improve frontend, separate configuration page, make things more responsive and stuff more thingy.
- Possibility to configure the analog temperature sensor specifications via frontend.
- Support other display types and make the output customizable, e.g. modify text and change the source sensor of temperature readings.
- Support MQTT.
- Support to import the configuration file.

## Screenshots

### Web interface

![The web interface](https://github.com/faeibson/ESPPWMFanControl/raw/master/screenshots/web_interface_1.0beta2.png "The web interface")

### JSON output
![JSON output](https://github.com/faeibson/ESPPWMFanControl/raw/master/screenshots/json_output_1.0beta2.png "JSON output")

## Changelog

### 1.0-beta2

- Code refactored, improved and cleaned up a lot
- Moved static content (favicon, JavaScript, CSS) to progmem assets
- Added download settings + restart ESP options
- Improved the frontend slightly. Will improve more ;)
- Fan control is not fixed to three sets anymore: Supports up to nine dynamically insertable/removable fan control sets each with independent speeds and temperature threshold
